

## PNG是什么

便携式网络图形（Portable Network Graphics，PNG）是一种无损压缩的位图片形格式，其设计目的是试图替代[GIF](https://baike.baidu.com/item/GIF)和[TIFF](https://baike.baidu.com/item/TIFF/2106)文件格式，同时增加一些[GIF文件格式](https://baike.baidu.com/item/GIF文件格式)所不具备的特性作为适合网络传输的格式而不需专利许可。PNG使用从LZ77派生的无损数据压缩算法，压缩比高，生成文件体积小。

## 特性

**体积小** 网络通讯中因受带宽制约，在保证图片清晰、逼真的前提下，网页中不可能大范围的使用文件较大的[bmp](https://baike.baidu.com/item/bmp)格式文件。

无损压缩 PNG文件采用LZ77算法的派生算法进行压缩，其结果是获得高的压缩比，不损失数据。它利用特殊的编码方法标记重复出现的数据，因而对图像的颜色没有影响，也不可能产生颜色的损失，这样就可以重复保存而不降低图像质量。

**索引彩色模式** PNG-8格式与GIF图像类似，同样采用8位调色板将RGB彩色图像转换为索引彩色图像。图像中保存的不再是各个像素的彩色信息，而是从图像中挑选出来的具有代表性的颜色编号，每一编号对应一种颜色，图像的数据量也因此减少，这对彩色图像的传播非常有利。

**更优化的网络传输显示** PNG图像在浏览器上采用流式浏览，即使经过交错处理的图像会在完全下载之前提供浏览者一个基本的图像内容，然后再逐渐清晰起来。它允许连续读出和写入图像数据，这个特性很适合于在通信过程中显示和生成图像。

**支持透明效果** PNG可以为原图像定义256个透明层次，使得彩色图像的边缘能与任何背景平滑地融合，从而彻底地消除锯齿边缘。这种功能是GIF和JPEG没有的。

PNG同时还支持真彩和灰度级图像的Alpha通道透明度。 [3]  最高支持24位[真彩色](https://baike.baidu.com/item/真彩色)图像以及8位[灰度图像](https://baike.baidu.com/item/灰度图像)。支持[Alpha通道](https://baike.baidu.com/item/Alpha通道)的透明/半透明特性。支持图像亮度的Gamma校准信息。支持存储附加文本信息，以保留图像名称、作者、[版权](https://baike.baidu.com/item/版权)、创作时间、注释等信息。

## 数据块结构

PNG[图像格式](https://baike.baidu.com/item/图像格式)文件（或者称为数据流）由一个8字节的PNG文件署名（PNG file signature）域和按照特定结构组织的3个以上的[数据块](https://baike.baidu.com/item/数据块)（chunk）组成。

PNG定义了两种类型的[数据块](https://baike.baidu.com/item/数据块)，一种是称为关键数据块（critical chunk），这是必需的数据块，另一种叫做[辅助数据](https://baike.baidu.com/item/辅助数据)块（ancillary chunks），这是可选的数据块。关键数据块定义了4个标准数据块，每个PNG文件都必须包含它们，PNG读写软件也都必须要支持这些数据块。虽然PNG文件规范没有要求PNG编[译码器](https://baike.baidu.com/item/译码器)对可选数据块进行编码和译码，但规范提倡支持可选数据块。

每个数据块都由表6-07所示的的4个域组成：

- 长度.

  一个4字节的无符号整数，给出数据块的数据字段的长度（以字节计）。 长度只计算数据域，为了兼容一些不支持无符号的语言，所以长度限制在（231-1）字节，不能达到(（232-1)字节。

- 数据块类型码.

  一个4字节的块类型代码。 为了便于描述和检查PNG文件，类型代码仅限于大写和小写的ASCII字母（A - Z和a - z，使用十进制ASCII代码表示为65-90和97-122）。 然而，编码器和解码器必须把代码作为固定的二进制值而非字符串来处理。

- 数据域.

  数据块的数据域，存储按照数据块类型码指定的数据（如果有的话）。 该字段可以是长度为零。

- 循环冗余检测.

  一个4字节的CRC（循环冗余校验）计算，在所述块的前面的字节，包括该块类型的代码和数据块的数据字段，但是**不**包括长度字段。 CRC始终存在，即使不包含数据块。

## PNG格式

PNG格式有8位、24位、32位三种形式，其中8位PNG支持两种不同的透明形式（索引透明和alpha透明），24位PNG不支持透明，32位PNG在24位基础上增加了8位透明通道，因此可展现256级透明程度。

PNG8和PNG24后面的数字则是代表这种PNG格式最多可以索引和存储的颜色值。8代表2的8次方也就是256色，而24则代表2的24次方大概有1600多万色。





## 参考链接

1. [A simple libpng example program](http://zarb.org/~gc/html/libpng.html)
2. [libpng-1.6.37](http://www.linuxfromscratch.org/blfs/view/svn/general/libpng.html)
3. http://www.libpng.org/

